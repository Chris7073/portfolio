import{d as X,_ as Y,a as Z,b as ee,c as te}from"./vknXrGkI.js";import{_ as ae}from"./7BipDWe9.js";import{_ as le,a as oe}from"./CEVZJrC7.js";import ne from"./F9lAl6My.js";import{_ as se}from"./D9_uRfKO.js";import{m as D,C as re,D as ue,E as ie,j as h,r as j,G as J,H as de,s as R,o as E,w as u,I as A,b as r,l as n,J as F,P as q,K as ce,L as pe,M as S,N as me,O as fe,Q as ve,R as N,S as Q,T as _e,U as O,c as G,a as T,d as M,F as ge,q as he,x as ye}from"./BRJGdOIR.js";import{_ as be}from"./Bc-OV4gi.js";import{u as xe,a as Ve}from"./TYZrQWTZ.js";import{r as z}from"./D_774sHo.js";import{u as we}from"./B5rxJs06.js";import{s as H}from"./vF40CwvS.js";import"./DdCi-vr8.js";const[Ce,$e]=de("PinInputRoot"),Pe=D({inheritAttrs:!1,__name:"PinInputRoot",props:{modelValue:{},defaultValue:{},placeholder:{default:""},mask:{type:Boolean},otp:{type:Boolean},type:{default:"text"},dir:{},disabled:{type:Boolean},id:{},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean}},emits:["update:modelValue","complete"],setup(v,{emit:s}){const t=v,o=s,{mask:c,otp:_,placeholder:$,type:p,disabled:l,dir:y}=re(t),{forwardRef:i}=ue(),b=xe(y),m=ie(t,"modelValue",o,{defaultValue:t.defaultValue??[],passive:t.modelValue===void 0}),P=h(()=>Array.isArray(m.value)?[...m.value]:[]),x=j(new Set);function k(f){x.value.add(f)}const V=h(()=>P.value.filter(w=>!!w).length===x.value.size);return J(m,()=>{V.value&&o("complete",m.value)},{deep:!0}),$e({modelValue:m,currentModelValue:P,mask:c,otp:_,placeholder:$,type:p,dir:b,disabled:l,isCompleted:V,inputElements:x,onInputElementChange:k}),(f,w)=>(E(),R(n(q),F(f.$attrs,{ref:n(i),dir:n(b),"data-complete":V.value?"":void 0,"data-disabled":n(l)?"":void 0}),{default:u(()=>[A(f.$slots,"default",{modelValue:n(m)}),r(be,{id:f.id,as:"input",feature:"focusable",tabindex:"-1",value:P.value.join(""),name:f.name??"",disabled:n(l),required:f.required,onFocus:w[0]||(w[0]=g=>{var I,B;return(B=(I=Array.from(x.value))==null?void 0:I[0])==null?void 0:B.focus()})},null,8,["id","value","name","disabled","required"])]),_:3},16,["dir","data-complete","data-disabled"]))}}),Be=D({__name:"PinInputInput",props:{index:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{default:"input"}},setup(v){const s=v,t=Ce(),o=h(()=>Array.from(t.inputElements.value)),c=h(()=>t.currentModelValue.value[s.index]),_=h(()=>s.disabled||t.disabled.value),$=h(()=>t.otp.value),p=h(()=>t.type.value==="number"),l=h(()=>t.mask.value),{primitiveElement:y,currentElement:i}=Ve();function b(e){var C;const a=e.target;if((((C=e.data)==null?void 0:C.length)??0)>1){g(a.value);return}if(p.value&&!/^\d*$/.test(a.value)){a.value=a.value.replace(/\D/g,"");return}a.value=a.value.slice(-1),B(s.index,a.value);const d=o.value[s.index+1];d&&d.focus()}function m(){const e=i.value;fe(()=>{e&&!e.value&&(e.placeholder=t.placeholder.value)})}function P(e){we(e,me(),void 0,{itemsArray:o.value,focus:!0,loop:!1,arrowKeyOptions:"horizontal",dir:t.dir.value})}function x(e){if(e.preventDefault(),e.target.value)B(s.index,"");else{const C=o.value[s.index-1];C&&(C.focus(),B(s.index-1,""))}}function k(e){e.key==="Delete"&&(e.preventDefault(),B(s.index,""))}function V(e){const a=e.target;a.setSelectionRange(1,1),a.value||(a.placeholder="")}function f(e){m()}function w(e){e.preventDefault();const a=e.clipboardData;if(!a)return;const d=a.getData("text");g(d)}function g(e){var K;const a=[...t.currentModelValue.value],d=e.length>=o.value.length?0:s.index,C=Math.min(d+e.length,o.value.length);for(let U=d;U<C;U++){const W=o.value[U],L=e[U-d];p.value&&!/^\d*$/.test(L)||(a[U]=L,W.focus())}t.modelValue.value=a,(K=o.value[C])==null||K.focus()}function I(e){let a=e.length-1;for(;a>=0&&e[a]==="";)e.pop(),a--;return e}function B(e,a){const d=[...t.currentModelValue.value];d[e]=p.value?+a:a,t.modelValue.value=I(d)}return J(c,()=>{c.value||m()}),ce(()=>{t.onInputElementChange(i.value)}),pe(()=>{var e;(e=t.inputElements)==null||e.value.delete(i.value)}),(e,a)=>(E(),R(n(q),{ref_key:"primitiveElement",ref:y,autocapitalize:"none",as:e.as,"as-child":e.asChild,autocomplete:$.value?"one-time-code":"false",type:l.value?"password":"text",inputmode:p.value?"numeric":"text",pattern:p.value?"[0-9]*":void 0,placeholder:n(t).placeholder.value,value:c.value,disabled:_.value,"data-disabled":_.value?"":void 0,"data-complete":n(t).isCompleted.value?"":void 0,"aria-label":`pin input ${e.index+1} of ${o.value.length}`,onInput:a[0]||(a[0]=d=>b(d)),onKeydown:[S(P,["left","right","up","down","home","end"]),S(x,["backspace"]),S(k,["delete"])],onFocus:V,onBlur:f,onPaste:w},{default:u(()=>[A(e.$slots,"default")]),_:3},8,["as","as-child","autocomplete","type","inputmode","pattern","placeholder","value","disabled","data-disabled","data-complete","aria-label"]))}}),Ee=D({__name:"PinInput",props:{modelValue:{default:()=>[]},defaultValue:{},placeholder:{},mask:{type:Boolean},otp:{type:Boolean},type:{},dir:{},disabled:{type:Boolean},id:{},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean},class:{}},emits:["update:modelValue","complete"],setup(v,{emit:s}){const t=v,o=s,c=z(t,"class"),_=ve(c,o);return($,p)=>(E(),R(n(Pe),F(n(_),{class:n(N)("flex gap-2 items-center",t.class)}),{default:u(()=>[A($.$slots,"default")]),_:3},16,["class"]))}}),ke=D({__name:"PinInputGroup",props:{asChild:{type:Boolean},as:{},class:{}},setup(v){const s=v,t=z(s,"class"),o=Q(t);return(c,_)=>(E(),R(n(q),F(n(o),{class:n(N)("flex items-center",s.class)}),{default:u(()=>[A(c.$slots,"default")]),_:3},16,["class"]))}}),Ie=D({__name:"PinInputInput",props:{index:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(v){const s=v,t=z(s,"class"),o=Q(t);return(c,_)=>(E(),R(n(Be),F(n(o),{class:n(N)("relative text-center focus:outline-none focus:ring-2 focus:ring-ring focus:relative focus:z-10 flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",s.class)}),null,16,["class"]))}}),Me={class:"flex justify-center h-screen w-full bg-blue-500/80"},De={class:"content-center"},Oe=D({__name:"login",setup(v){const s=_e(),t=j([]),o=j("");O();const c=h(()=>t.value.length===5),{fetch:_}=O();async function $(){var p,l,y;try{const i=await $fetch("/api/auth/login",{method:"POST",body:{code:t.value,mail:o.value}});i.success?(await _(),await ye("/dashboard/")):(t.value=[],o.value="",H(i.message||"Credenziali non corrette","error"))}catch(i){t.value=[],o.value="",console.error("Errore durante il tentativo di login:",i);const b=((p=i.data)==null?void 0:p.message)||((y=(l=i.data)==null?void 0:l.body)==null?void 0:y.message)||"Errore durante il login. Riprova.";H(b,"error")}}return(p,l)=>{const y=Z,i=ee,b=Y,m=le,P=oe,x=te,k=ne,V=se,f=ae,w=X;return E(),G("div",Me,[T("div",De,[r(w,{class:"w-100 h-fit"},{default:u(()=>[r(b,null,{default:u(()=>[r(y,null,{default:u(()=>l[3]||(l[3]=[M("Login")])),_:1}),r(i,null,{default:u(()=>l[4]||(l[4]=[M("Use your private code for accessing")])),_:1})]),_:1}),r(x,{class:"flex flex-col gap-4"},{default:u(()=>[T("div",null,[r(m,null,{default:u(()=>l[5]||(l[5]=[M("User Mail")])),_:1}),r(P,{placeholder:"User Mail",type:"email",modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=g=>o.value=g)},null,8,["modelValue"])]),T("div",null,[r(m,null,{default:u(()=>l[6]||(l[6]=[M("User Private Code")])),_:1}),r(n(Ee),{class:"flex justify-center",id:"pin-input",modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=g=>t.value=g),placeholder:"o"},{default:u(()=>[r(n(ke),null,{default:u(()=>[(E(),G(ge,null,he(5,(g,I)=>r(n(Ie),{type:"password",class:"w-full h-[4rem] text-xl",key:g,index:I},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue"])])]),_:1}),r(f,{class:"flex justify-between"},{default:u(()=>[r(V,{onClick:l[2]||(l[2]=g=>n(s).back()),variant:"ghost"},{default:u(()=>[r(k,{name:"uil:arrow-left"}),l[7]||(l[7]=M("go back "))]),_:1}),r(V,{disabled:!n(c),onClick:$},{default:u(()=>[r(k,{name:"uil:check"}),l[8]||(l[8]=M("Enter "))]),_:1},8,["disabled"])]),_:1})]),_:1})])])}}});export{Oe as default};
